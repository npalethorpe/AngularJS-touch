app.directive("fTouch",["$window","$timeout",function(o,e){return{restrict:"A",scope:{stopPropagation:"=?stoppropagation",triggeredTaps:"=?triggeredtaps",onTouchstart:"&fTouchstart",onShortpress:"&fShortpress",onLongpress:"&fLongpress",onTap:"&fTap",onLongtap:"&fLongtap",onMove:"&fMove",onPinch:"&fPinch",onSwipeleft:"&fSwipeleft",onSwiperight:"&fSwiperight",onSlidingx:"&fSlidingx",onSlidingy:"&fSlidingy",onTouchendnodrag:"&fTouchendnodrag",onTouchend:"&fTouchend",onTriggeredTap:"&fTriggeredtap"},link:function(n,t,i){var a,r,g,p=0,c=0,d=0,s=.05*o.innerWidth,u=!1,h=!1,f=!1,w=0,l=0,v="ontouchstart"in window?"touchstart":window.navigator.pointerEnabled?"pointerdown":window.navigator.msPointerEnabled?"MSPointerDown":"click",T="ontouchend"in window?"touchend":window.navigator.pointerEnabled?"pointerup":window.navigator.msPointerEnabled?"MSPointerUp":"",S="ontouchmove"in window?"touchmove":window.navigator.pointerEnabled?"pointermove":window.navigator.msPointerEnabled?"MSPointerMove":"",P=!1,b=500,m=2e3,M=.2*o.innerWidth,E=300,X=-1,Y=0,D=0,L=function(o){o.off(),o.unbind()},k=function(){e.cancel(r),e.cancel(g)};L(t),t.bind(v,function(o){u=!1,P=!1,h=!1,k(),a=(new Date).getTime(),t.addClass("ftouchdown"),e(function(){u||(r=e(function(){P||u||h||n.onShortpress({e:o})},b),g=e(function(){P||u||h||n.onLongpress({e:o})},m),n.onTouchstart({e:o})),2==o.touches.length&&(f=!0,k(),w=Math.sqrt((o.touches[0].pageX-o.touches[1].pageX)*(o.touches[0].pageX-o.touches[1].pageX)+(o.touches[0].pageY-o.touches[1].pageY)*(o.touches[0].pageY-o.touches[1].pageY)))},80),p=o.pageX||o.originalEvent.pageX||o.originalEvent.targetTouches[0].pageX,c=o.pageY||o.originalEvent.pageY||o.originalEvent.targetTouches[0].pageY,(void 0===p||void 0===c)&&(p=-1,c=-1,n.onTouchend({e:o})),n.stopPropagation&&(o.stopPropagation(),o.preventDefault())}),t.bind(S,function(o){n.onMove({e:o});var e=-1,i=-1;f?(e=o.touches[0].pageX-o.touches[1].pageX,i=o.touches[0].pageY-o.touches[1].pageY,l=Math.sqrt(e*e+i*i),n.onPinch({e:l-w})):(e=p-o.touches[0].pageX,i=c-o.touches[0].pageY,d=Math.sqrt(e*e+i*i),d>s&&(u===!1&&(u=!0,t.removeClass("ftouchdown")),-1==X&&(X=Math.abs(e)>Math.abs(i)?0>e?1:3:0>i?2:0),0===X||2==X?(X=0>i?2:0,n.onSlidingy({e:i})):(1==X||3==X)&&(X=0>e?1:3,n.onSlidingx({e:e}))))}),t.bind(T,function(o){var e=(new Date).getTime();return o.touches.length>0?void(f=!1):(h=!0,k(),u===!1&&P===!1?(b>e-a?(n.onTap({e:o}),void 0!==n.triggeredTaps&&((void 0===D||(new Date).getTime()-D>800)&&(Y=0),Y++,D=(new Date).getTime(),Y>=n.triggeredTaps&&(Y=0,n.onTriggeredTap({e:o})))):m>e-a&&n.onLongtap({e:o}),n.onTouchendnodrag({e:o})):u&&E>=e-a&&d>=M&&(1==X?n.onSwiperight({e:o}):3==X&&n.onSwipeleft({e:o})),X=-1,t.removeClass("ftouchdown"),n.onTouchend({e:o}),void(n.stopPropagation&&(o.stopPropagation(),o.preventDefault())))}),t.bind("click",function(o){o.preventDefault()})}}}]);
